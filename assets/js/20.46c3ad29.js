(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{222:function(e,t,s){"use strict";s.r(t);var r=s(0),a=Object(r.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"跨域资源共享"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域资源共享","aria-hidden":"true"}},[e._v("#")]),e._v(" 跨域资源共享")]),e._v(" "),s("blockquote",[s("p",[e._v("CORS（Cross-Origin Resource Sharing，跨源资源共享）定义了在必须访问跨源资源时，浏览器与服务器应该如何沟通。")])]),e._v(" "),s("p",[e._v("CORS 背后的基本思想，就是使用自定义的 HTTP 头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功，还是应该失败。")]),e._v(" "),s("h2",{attrs:{id:"http-头部信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-头部信息","aria-hidden":"true"}},[e._v("#")]),e._v(" HTTP 头部信息")]),e._v(" "),s("p",[e._v("默认情况下，在发送 XHR 请求的同时，还会发送下列头部信息。")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("Accept")]),e._v(":浏览器能够处理的内容类型。")]),e._v(" "),s("li",[s("code",[e._v("Accept-Charset")]),e._v(":浏览器能够显示的字符集。")]),e._v(" "),s("li",[s("code",[e._v("Accept-Encoding")]),e._v(":浏览器能够处理的压缩编码。")]),e._v(" "),s("li",[s("code",[e._v("Accept-Language")]),e._v(":浏览器当前设置的语言。")]),e._v(" "),s("li",[s("code",[e._v("Connection")]),e._v(":浏览器与服务器之间连接的类型。")]),e._v(" "),s("li",[s("code",[e._v("Cookie")]),e._v(":当前页面设置的任何 Cookie。")]),e._v(" "),s("li",[s("code",[e._v("Host")]),e._v(":发出请求的页面所在的域 。")]),e._v(" "),s("li",[s("code",[e._v("Referer")]),e._v(":发出请求的页面的 URI。注意，HTTP 规范将这个头部字段拼写错了，而为保证与规一致，也只能将错就错了。(这个英文单词的正确拼法应该是 referrer。)")]),e._v(" "),s("li",[s("code",[e._v("User-Agent")]),e._v(":浏览器的用户代理字符串。")])]),e._v(" "),s("p",[e._v("比如一个简单的使用 GET 或 POST 发送的请求，它没有自定义的头部，而主体内容是 text/plain。在 发送该请求时，需要给它附加一个额外的 Origin 头部，其中包含请求页面的源信息(协议、域名和端 口)，以便服务器根据这个头部信息来决定是否给予响应。下面是 Origin 头部的一个示例")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Origin: http://www.nczonline.net\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v('如果服务器认为这个请求可以接受，就在 Access-Control-Allow-Origin 头部中回发相同的源信息(如果是公共资源，可以回发"*")。例如:')]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Access-Control-Allow-Origin: http://www.nczonline.net\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("如果没有这个头部，或者有这个头部但源信息不匹配，浏览器就会驳回请求。正常情况下，浏览器 会处理请求。注意，请求和响应都不包含 cookie 信息。")]),e._v(" "),s("p",[e._v("跨域 XHR 对象也有一些限制，但为了安全这些限制是必需的。以下就是这些限制。")]),e._v(" "),s("ul",[s("li",[e._v("不能使用 setRequestHeader()设置自定义头部。")]),e._v(" "),s("li",[e._v("不能发送和接收 cookie。")]),e._v(" "),s("li",[e._v("调用 getAllResponseHeaders()方法总会返回空字符串")])]),e._v(" "),s("h2",{attrs:{id:"预检请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#预检请求","aria-hidden":"true"}},[e._v("#")]),e._v(" 预检请求")]),e._v(" "),s("blockquote",[s("p",[e._v("CORS 通过一种叫做 Preflighted Requests 的透明服务器验证机制支持开发人员使用自定义的头部、\nGET 或 POST 之外的方法，以及不同类型的主体内容。在使用下列高级选项来发送请求时，就会向服务\n器发送一个 Preflight 请求。这种请求使用 OPTIONS 方法，发送下列头部。")])]),e._v(" "),s("h3",{attrs:{id:"简单请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简单请求","aria-hidden":"true"}},[e._v("#")]),e._v(" 简单请求")]),e._v(" "),s("p",[e._v("只要同时满足以下两大条件，就属于简单请求")]),e._v(" "),s("p",[s("strong",[e._v("条件 1")]),e._v("：使用下列方法之一：")]),e._v(" "),s("ul",[s("li",[e._v("GET")]),e._v(" "),s("li",[e._v("HEAD")]),e._v(" "),s("li",[e._v("POST")])]),e._v(" "),s("p",[s("strong",[e._v("条件 2")]),e._v("：Content-Type 的值仅限于下列三者之一：")]),e._v(" "),s("ul",[s("li",[e._v("text/plain")]),e._v(" "),s("li",[e._v("multipart/form-data")]),e._v(" "),s("li",[e._v("application/x-www-form-urlencoded")])]),e._v(" "),s("h3",{attrs:{id:"复杂请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#复杂请求","aria-hidden":"true"}},[e._v("#")]),e._v(" 复杂请求")]),e._v(" "),s("p",[e._v("不符合以简单请求条件的请求就肯定是复杂请求了。")]),e._v(" "),s("p",[e._v("复杂请求的 CORS 请求，会在正式通信之前，增加一次 HTTP 查询请求，称为 "),s("strong",[e._v('"预检"请求')]),e._v(" ,该请求是 option 方法的，通过该请求来知道服务端是否允许跨域请求。")]),e._v(" "),s("h3",{attrs:{id:"options-请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#options-请求","aria-hidden":"true"}},[e._v("#")]),e._v(" OPTIONS 请求")]),e._v(" "),s("p",[s("strong",[e._v("请求头信息")])]),e._v(" "),s("ul",[s("li",[e._v("Origin：与简单的请求相同。")]),e._v(" "),s("li",[e._v("Access-Control-Request-Method：请求自身使用的方法。")]),e._v(" "),s("li",[e._v("Access-Control-Request-Headers：（可选）自定义的头部信息，多个头部以逗号分隔。")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.loli.net/2019/12/25/ojuFz3BED2TSG6M.png",alt:"request-headers"}})]),e._v(" "),s("p",[s("strong",[e._v("响应头信息")])]),e._v(" "),s("ul",[s("li",[e._v("Access-Control-Allow-Origin：与简单的请求相同。")]),e._v(" "),s("li",[e._v("Access-Control-Allow-Methods：允许的方法，多个方法以逗号分隔。")]),e._v(" "),s("li",[e._v("Access-Control-Allow-Headers：允许的头部，多个头部以逗号分隔。")]),e._v(" "),s("li",[e._v("Access-Control-Max-Age：应该将这个 Preflight 请求缓存多长时间（以秒表示）")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://i.loli.net/2019/12/25/QJdwTpY2vAZEsxU.png",alt:"response-headers"}})]),e._v(" "),s("h2",{attrs:{id:"带凭据的请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#带凭据的请求","aria-hidden":"true"}},[e._v("#")]),e._v(" 带凭据的请求")]),e._v(" "),s("p",[e._v("默认情况下，跨源请求不提供凭据（cookie、HTTP 认证及客户端 SSL 证明 等 ）。 通 过 将 withCredentials 属性设置为 true，可以指定某个请求应该发送凭据。如果服务器接受带凭据的请求，会用下面的 HTTP 头部来响应。")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Access-Control-Allow-Credentials: true\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("如果发送的是带凭据的请求，但服务器的响应中没有包含这个头部，那么浏览器就不会把响应交给\nJavaScript（于是，responseText 中将是空字符串，status 的值为 0，而且会调用 onerror()事件处\n理程序）。另外，服务器还可以在 Preflight 响应中发送这个 HTTP 头部，表示允许源发送带凭据的请求。")]),e._v(" "),s("p",[e._v("服务器可以设置浏览器的 cookie 但是请求上带不带上 cookie 是浏览器决定的。")])])},[],!1,null,null,null);t.default=a.exports}}]);