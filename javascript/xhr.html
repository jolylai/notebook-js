<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>XMLHttpRequest | JavaScript</title>
    <meta name="description" content="ğŸš€ ç²¾é€š JavaScript">
    <link rel="icon" href="/notebook-js/favicon.ico">
    
    <link rel="preload" href="/notebook-js/assets/css/0.styles.a0904ea6.css" as="style"><link rel="preload" href="/notebook-js/assets/js/app.0452984d.js" as="script"><link rel="preload" href="/notebook-js/assets/js/2.aba41126.js" as="script"><link rel="preload" href="/notebook-js/assets/js/30.a8cb2a05.js" as="script"><link rel="prefetch" href="/notebook-js/assets/js/10.d88a676f.js"><link rel="prefetch" href="/notebook-js/assets/js/11.89848593.js"><link rel="prefetch" href="/notebook-js/assets/js/12.3162b2c4.js"><link rel="prefetch" href="/notebook-js/assets/js/13.28489938.js"><link rel="prefetch" href="/notebook-js/assets/js/14.add19b0b.js"><link rel="prefetch" href="/notebook-js/assets/js/15.64fce0f4.js"><link rel="prefetch" href="/notebook-js/assets/js/16.1dfc6fce.js"><link rel="prefetch" href="/notebook-js/assets/js/17.778e636a.js"><link rel="prefetch" href="/notebook-js/assets/js/18.2a0d9f3d.js"><link rel="prefetch" href="/notebook-js/assets/js/19.bba73fc7.js"><link rel="prefetch" href="/notebook-js/assets/js/20.46c3ad29.js"><link rel="prefetch" href="/notebook-js/assets/js/21.e6f08e2c.js"><link rel="prefetch" href="/notebook-js/assets/js/22.555997ae.js"><link rel="prefetch" href="/notebook-js/assets/js/23.3c056bd0.js"><link rel="prefetch" href="/notebook-js/assets/js/24.231d992a.js"><link rel="prefetch" href="/notebook-js/assets/js/25.a6987b1f.js"><link rel="prefetch" href="/notebook-js/assets/js/26.73709f9c.js"><link rel="prefetch" href="/notebook-js/assets/js/27.e7f6e612.js"><link rel="prefetch" href="/notebook-js/assets/js/28.f01ae49c.js"><link rel="prefetch" href="/notebook-js/assets/js/29.a79bf92e.js"><link rel="prefetch" href="/notebook-js/assets/js/3.9e291f24.js"><link rel="prefetch" href="/notebook-js/assets/js/31.6203148c.js"><link rel="prefetch" href="/notebook-js/assets/js/32.59fafb0e.js"><link rel="prefetch" href="/notebook-js/assets/js/33.591859bb.js"><link rel="prefetch" href="/notebook-js/assets/js/34.4e885d42.js"><link rel="prefetch" href="/notebook-js/assets/js/35.90699062.js"><link rel="prefetch" href="/notebook-js/assets/js/36.6b0c2ef5.js"><link rel="prefetch" href="/notebook-js/assets/js/37.e8616bb0.js"><link rel="prefetch" href="/notebook-js/assets/js/38.309bb7c9.js"><link rel="prefetch" href="/notebook-js/assets/js/39.502c41ad.js"><link rel="prefetch" href="/notebook-js/assets/js/4.b7e81047.js"><link rel="prefetch" href="/notebook-js/assets/js/40.2fbd782e.js"><link rel="prefetch" href="/notebook-js/assets/js/41.379419b5.js"><link rel="prefetch" href="/notebook-js/assets/js/42.d56e6c48.js"><link rel="prefetch" href="/notebook-js/assets/js/43.6d47cd58.js"><link rel="prefetch" href="/notebook-js/assets/js/44.f036d0da.js"><link rel="prefetch" href="/notebook-js/assets/js/45.6a7bad1e.js"><link rel="prefetch" href="/notebook-js/assets/js/46.636bc99f.js"><link rel="prefetch" href="/notebook-js/assets/js/47.fb0724c6.js"><link rel="prefetch" href="/notebook-js/assets/js/48.d64dcf31.js"><link rel="prefetch" href="/notebook-js/assets/js/49.5d3b1e85.js"><link rel="prefetch" href="/notebook-js/assets/js/5.0b0b5417.js"><link rel="prefetch" href="/notebook-js/assets/js/50.7409cc3a.js"><link rel="prefetch" href="/notebook-js/assets/js/51.9111653c.js"><link rel="prefetch" href="/notebook-js/assets/js/52.2f6038c9.js"><link rel="prefetch" href="/notebook-js/assets/js/53.bb0e8e9e.js"><link rel="prefetch" href="/notebook-js/assets/js/54.797e93eb.js"><link rel="prefetch" href="/notebook-js/assets/js/6.ab5d0853.js"><link rel="prefetch" href="/notebook-js/assets/js/7.ed705cb3.js"><link rel="prefetch" href="/notebook-js/assets/js/8.1b42af23.js"><link rel="prefetch" href="/notebook-js/assets/js/9.7767f707.js">
    <link rel="stylesheet" href="/notebook-js/assets/css/0.styles.a0904ea6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook-js/" class="home-link router-link-active"><!----> <span class="site-name">JavaScript</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notebook-js/javascript/" class="nav-link router-link-active">JSåŸºç¡€</a></div><div class="nav-item"><a href="/notebook-js/design-pattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div> <a href="https://github.com/Jolylai/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notebook-js/javascript/" class="nav-link router-link-active">JSåŸºç¡€</a></div><div class="nav-item"><a href="/notebook-js/design-pattern/" class="nav-link">è®¾è®¡æ¨¡å¼</a></div> <a href="https://github.com/Jolylai/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JSåŸºç¡€</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook-js/javascript/" class="sidebar-link">Guide</a></li><li><a href="/notebook-js/javascript/types.html" class="sidebar-link">ç±»å‹</a></li><li><a href="/notebook-js/javascript/coercion.html" class="sidebar-link">å¼ºåˆ¶ç±»å‹è½¬æ¢</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ajax</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook-js/javascript/cors.html" class="sidebar-link">è·¨åŸŸèµ„æºå…±äº«</a></li><li><a href="/notebook-js/javascript/xhr.html" class="active sidebar-link">XMLHttpRequest</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook-js/javascript/xhr.html#get" class="sidebar-link">GET</a></li><li class="sidebar-sub-header"><a href="/notebook-js/javascript/xhr.html#post-è¯·æ±‚" class="sidebar-link">POST è¯·æ±‚</a></li><li class="sidebar-sub-header"><a href="/notebook-js/javascript/xhr.html#è·å–å“åº”" class="sidebar-link">è·å–å“åº”</a></li><li class="sidebar-sub-header"><a href="/notebook-js/javascript/xhr.html#è¶…æ—¶è®¾å®š" class="sidebar-link">è¶…æ—¶è®¾å®š</a></li><li class="sidebar-sub-header"><a href="/notebook-js/javascript/xhr.html#é‡å†™å“åº”çš„-mime-ç±»å‹" class="sidebar-link">é‡å†™å“åº”çš„ MIME ç±»å‹</a></li><li class="sidebar-sub-header"><a href="/notebook-js/javascript/xhr.html#å–æ¶ˆè¯·æ±‚" class="sidebar-link">å–æ¶ˆè¯·æ±‚</a></li><li class="sidebar-sub-header"><a href="/notebook-js/javascript/xhr.html#æºå¸¦å‡­è¯" class="sidebar-link">æºå¸¦å‡­è¯</a></li><li class="sidebar-sub-header"><a href="/notebook-js/javascript/xhr.html#è¿›åº¦äº‹ä»¶" class="sidebar-link">è¿›åº¦äº‹ä»¶</a></li><li class="sidebar-sub-header"><a href="/notebook-js/javascript/xhr.html#ä¼˜è´¨ä»£ç " class="sidebar-link">ä¼˜è´¨ä»£ç </a></li></ul></li><li><a href="/notebook-js/javascript/fetch.html" class="sidebar-link">fetch</a></li><li><a href="/notebook-js/javascript/axios.html" class="sidebar-link">axios</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="xmlhttprequest"><a href="#xmlhttprequest" aria-hidden="true" class="header-anchor">#</a> XMLHttpRequest</h1> <h2 id="get"><a href="#get" aria-hidden="true" class="header-anchor">#</a> GET</h2> <p>ç”¨<code>XMLHttpRequest</code> å‘ <code>http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401</code> æ¥å£å‘å‡ºä¸€ä¸ª get è¯·æ±‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è·å–å“åº”çš„æ•°æ®</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// open()æ–¹æ³•å¹¶ä¸ä¼šçœŸæ­£å‘é€è¯·æ±‚ï¼Œ è€Œåªæ˜¯å¯åŠ¨ä¸€ä¸ªè¯·æ±‚ä»¥å¤‡å‘é€ã€‚</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å¦‚æœä¸éœ€è¦é€šè¿‡è¯·æ±‚ä¸»ä½“å‘é€ æ•°æ®ï¼Œåˆ™å¿…é¡»ä¼ å…¥ nullï¼Œå› ä¸ºè¿™ä¸ªå‚æ•°å¯¹æœ‰äº›æµè§ˆå™¨æ¥è¯´æ˜¯å¿…éœ€çš„ã€‚</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>å¯ä»¥å°†æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°è¿½åŠ  åˆ° URL çš„æœ«å°¾ï¼Œä»¥ä¾¿å°†ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ï¼Œå¦‚ <code>&quot;http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401?name=jack&quot;</code>ã€‚æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­æ¯ä¸ªå‚æ•°çš„åç§°å’Œå€¼éƒ½å¿…é¡»ä½¿ç”¨ encodeURIComponent()è¿›è¡Œç¼–ç ï¼Œç„¶åæ‰èƒ½æ”¾åˆ° URL çš„æœ«å°¾;è€Œä¸”æ‰€æœ‰å-å€¼å¯¹ å„¿éƒ½å¿…é¡»ç”±å’Œå·(&amp;)åˆ†éš”ï¼Œä¸ç„¶ GET è¯·æ±‚ä¼šå‘ç”Ÿçš„ä¸€ä¸ªé”™è¯¯ï¼Œå°±æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²çš„æ ¼å¼æœ‰é—®é¢˜ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">addURLParam</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  url <span class="token operator">+=</span> url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;?&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;?&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">;</span>
  url <span class="token operator">+=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> url<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">addURLParam</span><span class="token punctuation">(</span>
  <span class="token string">&quot;http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;jack&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="post-è¯·æ±‚"><a href="#post-è¯·æ±‚" aria-hidden="true" class="header-anchor">#</a> POST è¯·æ±‚</h2> <p>é¦–å…ˆå°† Content-Type å¤´éƒ¨ä¿¡æ¯è®¾ç½®ä¸º application/x-www-form-urlencodedï¼Œä¹Ÿå°±æ˜¯è¡¨å• æäº¤æ—¶çš„å†…å®¹ç±»å‹ï¼Œå…¶æ¬¡æ˜¯ä»¥é€‚å½“çš„æ ¼å¼åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åºåˆ—åŒ–æ•°æ®</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pageNumber<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="formdata"><a href="#formdata" aria-hidden="true" class="header-anchor">#</a> FormData</h3> <p>FormData ä¸ºåºåˆ—åŒ–è¡¨å•ä»¥åŠåˆ›å»ºä¸è¡¨å•æ ¼å¼ç›¸åŒçš„æ•°æ®(ç”¨äºé€šè¿‡ XHR ä¼ è¾“)æä¾›äº†ä¾¿åˆ©ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// { list: [ 11, 22 ] }</span>
<span class="token keyword">const</span> formDataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formDataList<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;list[]&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
formDataList<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;list[]&quot;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>post è¯·æ±‚ä½¿ç”¨ FormData å‘é€æ•°æ®</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Nicholas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ä½¿ç”¨ FormData çš„æ–¹ä¾¿ä¹‹å¤„ä½“ç°åœ¨ä¸å¿…æ˜ç¡®åœ°åœ¨ XHR å¯¹è±¡ä¸Šè®¾ç½®è¯·æ±‚å¤´éƒ¨ã€‚XHR å¯¹è±¡èƒ½å¤Ÿè¯†åˆ«ä¼  å…¥çš„æ•°æ®ç±»å‹æ˜¯ FormData çš„å®ä¾‹ï¼Œå¹¶é…ç½®é€‚å½“çš„å¤´éƒ¨ä¿¡æ¯ã€‚</p> <h2 id="è·å–å“åº”"><a href="#è·å–å“åº”" aria-hidden="true" class="header-anchor">#</a> è·å–å“åº”</h2> <p>XHR å¯¹è±¡çš„ <code>readyState</code> å±æ€§è¡¨ç¤ºè¯·æ±‚ /å“åº”è¿‡ç¨‹çš„å½“å‰æ´»åŠ¨é˜¶æ®µï¼Œå¯¹åº”çš„å€¼å¦‚ä¸‹</p> <ul><li><code>0</code>:æœªåˆå§‹åŒ–ã€‚å°šæœªè°ƒç”¨ open()æ–¹æ³•ã€‚</li> <li><code>1</code>:å¯åŠ¨ã€‚å·²ç»è°ƒç”¨ open()æ–¹æ³•ï¼Œä½†å°šæœªè°ƒç”¨ send()æ–¹æ³•ã€‚</li> <li><code>2</code>:å‘é€ã€‚å·²ç»è°ƒç”¨ send()æ–¹æ³•ï¼Œä½†å°šæœªæ¥æ”¶åˆ°å“åº”ã€‚</li> <li><code>3</code>:æ¥æ”¶ã€‚å·²ç»æ¥æ”¶åˆ°éƒ¨åˆ†å“åº”æ•°æ®ã€‚</li> <li><code>4</code>:å®Œæˆã€‚å·²ç»æ¥æ”¶åˆ°å…¨éƒ¨å“åº”æ•°æ®ï¼Œè€Œä¸”å·²ç»å¯ä»¥åœ¨å®¢æˆ·ç«¯ä½¿ç”¨äº†ã€‚</li></ul> <p>åªè¦ <code>readyState</code> å±æ€§çš„å€¼ç”±ä¸€ä¸ªå€¼å˜æˆå¦ä¸€ä¸ªå€¼ï¼Œéƒ½ä¼šè§¦å‘ä¸€æ¬¡ <code>readystatechange</code> äº‹ä»¶ï¼Œå› æ­¤å¯ä»¥æ£€æµ‹ <code>XHR</code> å¯¹è±¡çš„ <code>readyState</code> å±æ€§æ¥åˆ¤æ–­æ˜¯å¦å·²ç»æ¥å—åˆ°å“åº”</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åœ¨æ”¶åˆ°å“åº”åï¼Œå“åº”çš„æ•°æ®ä¼šè‡ªåŠ¨å¡«å…… <code>XHR</code> å¯¹è±¡çš„å±æ€§ï¼Œç›¸å…³çš„å±æ€§ç®€ä»‹å¦‚ä¸‹ã€‚</p> <ul><li><code>responseText</code>:ä½œä¸ºå“åº”ä¸»ä½“è¢«è¿”å›çš„æ–‡æœ¬ã€‚</li> <li><code>responseXML</code>:å¦‚æœå“åº”çš„å†…å®¹ç±»å‹æ˜¯<code>&quot;text/xml&quot;æˆ–&quot;application/xml&quot;</code>ï¼Œè¿™ä¸ªå±æ€§ä¸­å­˜åŒ…å«ç€å“åº”æ•°æ®çš„ XML DOM æ–‡æ¡£ã€‚</li> <li><code>status</code>:å“åº”çš„ HTTP çŠ¶æ€ã€‚</li> <li><code>statusText</code>:HTTP çŠ¶æ€çš„è¯´æ˜ã€‚</li></ul> <p>æ— è®ºå†…å®¹ç±»å‹æ˜¯ä»€ä¹ˆï¼Œå“åº”ä¸»ä½“çš„å†…å®¹éƒ½ä¼šä¿å­˜åˆ° responseText å±æ€§ä¸­;è€Œ å¯¹äºé XML æ•°æ®è€Œè¨€ï¼ŒresponseXML å±æ€§çš„å€¼å°†ä¸º nullã€‚</p> <h2 id="è¶…æ—¶è®¾å®š"><a href="#è¶…æ—¶è®¾å®š" aria-hidden="true" class="header-anchor">#</a> è¶…æ—¶è®¾å®š</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request was unsuccessful: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//å‡è®¾ç”± ontimeout äº‹ä»¶å¤„ç†ç¨‹åºå¤„ç†</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;timeout.php&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">//å°†è¶…æ—¶è®¾ç½®ä¸º1ç§’é’Ÿ(ä»…é€‚ç”¨äºIE8+)</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request did not return in a second.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>å°† timeout å±æ€§è®¾ç½®ä¸º 1000 æ¯«ç§’ï¼Œæ„å‘³ç€å¦‚æœè¯·æ±‚åœ¨ 1 ç§’é’Ÿå†…è¿˜æ²¡æœ‰è¿”å›ï¼Œå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚è¯·æ±‚ç»ˆæ­¢æ—¶ï¼Œä¼šè°ƒç”¨ ontimeout äº‹ä»¶å¤„ç†ç¨‹åºã€‚ä½†æ­¤æ—¶ readyState å¯èƒ½å·²ç»æ”¹å˜ä¸º 4 äº†ï¼Œè¿™æ„å‘³ç€ä¼šè°ƒç”¨ onreadystatechange äº‹ä»¶å¤„ç†ç¨‹åºã€‚å¯æ˜¯ï¼Œå¦‚æœåœ¨è¶…æ—¶ç»ˆæ­¢ è¯·æ±‚ä¹‹åå†è®¿é—® status å±æ€§ï¼Œå°±ä¼šå¯¼è‡´é”™è¯¯ã€‚ä¸ºé¿å…æµè§ˆå™¨æŠ¥å‘Šé”™è¯¯ï¼Œå¯ä»¥å°†æ£€æŸ¥ status å±æ€§çš„è¯­
å¥å°è£…åœ¨ä¸€ä¸ª try-catch è¯­å¥å½“ä¸­ã€‚</p> <h2 id="é‡å†™å“åº”çš„-mime-ç±»å‹"><a href="#é‡å†™å“åº”çš„-mime-ç±»å‹" aria-hidden="true" class="header-anchor">#</a> é‡å†™å“åº”çš„ MIME ç±»å‹</h2> <p>æœåŠ¡å™¨è¿”å›çš„ MIME ç±»å‹æ˜¯ text/plainï¼Œä½†æ•°æ®ä¸­å®é™…åŒ…å«çš„æ˜¯ XMLã€‚æ ¹æ® MIME ç±»å‹ï¼Œ å³ä½¿æ•°æ®æ˜¯ XMLï¼ŒresponseXML å±æ€§ä¸­ä»ç„¶æ˜¯ nullã€‚é€šè¿‡è°ƒç”¨ overrideMimeType()æ–¹æ³•ï¼Œå¯ä»¥ä¿ è¯æŠŠå“åº”å½“ä½œ XML è€Œéçº¯æ–‡æœ¬æ¥å¤„ç†ã€‚</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">overrideMimeType</span><span class="token punctuation">(</span><span class="token string">&quot;text/xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è°ƒç”¨ overrideMimeType()å¿…é¡»åœ¨ send()æ–¹æ³•ä¹‹å‰ï¼Œæ‰èƒ½ä¿è¯é‡å†™å“åº”çš„ MIME ç±»å‹ã€‚</p> <h2 id="å–æ¶ˆè¯·æ±‚"><a href="#å–æ¶ˆè¯·æ±‚" aria-hidden="true" class="header-anchor">#</a> å–æ¶ˆè¯·æ±‚</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="æºå¸¦å‡­è¯"><a href="#æºå¸¦å‡­è¯" aria-hidden="true" class="header-anchor">#</a> æºå¸¦å‡­è¯</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;name=xiamen&quot;</span><span class="token punctuation">;</span> <span class="token comment">// cookieä¸èƒ½è·¨åŸŸ</span>
xhr<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// å‰ç«¯è®¾ç½®æ˜¯å¦å¸¦cookie</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="è¿›åº¦äº‹ä»¶"><a href="#è¿›åº¦äº‹ä»¶" aria-hidden="true" class="header-anchor">#</a> è¿›åº¦äº‹ä»¶</h2> <p>æ¯ä¸ªè¯·æ±‚éƒ½ä»è§¦å‘ loadstart äº‹ä»¶å¼€å§‹ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸€æˆ–å¤šä¸ª progress äº‹ä»¶ï¼Œç„¶åè§¦å‘ errorã€abort æˆ– load äº‹ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæœ€åä»¥è§¦å‘ loadend äº‹ä»¶ç»“æŸã€‚</p> <ul><li><code>loadstart</code>:åœ¨æ¥æ”¶åˆ°å“åº”æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ—¶è§¦å‘ã€‚</li> <li><code>progress</code>:åœ¨æ¥æ”¶å“åº”æœŸé—´æŒç»­ä¸æ–­åœ°è§¦å‘ã€‚</li> <li><code>error</code>:åœ¨è¯·æ±‚å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚</li> <li><code>abort</code>:åœ¨å› ä¸ºè°ƒç”¨ abort()æ–¹æ³•è€Œç»ˆæ­¢è¿æ¥æ—¶è§¦å‘ã€‚</li> <li><code>load</code>:åœ¨æ¥æ”¶åˆ°å®Œæ•´çš„å“åº”æ•°æ®æ—¶è§¦å‘ã€‚</li> <li><code>loadend</code>:åœ¨é€šä¿¡å®Œæˆæˆ–è€…è§¦å‘ errorã€abort æˆ– load äº‹ä»¶åè§¦å‘ã€‚</li></ul> <h3 id="load-äº‹ä»¶"><a href="#load-äº‹ä»¶" aria-hidden="true" class="header-anchor">#</a> load äº‹ä»¶</h3> <p>load äº‹ä»¶ï¼Œç”¨ä»¥æ›¿ä»£ readystatechange äº‹ä»¶ã€‚å“åº”æ¥æ”¶å®Œæ¯•åå°†è§¦å‘ load äº‹ä»¶ï¼Œå› æ­¤ä¹Ÿå°±æ²¡æœ‰å¿…è¦å»æ£€æŸ¥ readyState å±æ€§äº†ã€‚è€Œ onload äº‹ä»¶å¤„ç†ç¨‹åºä¼šæ¥æ”¶åˆ°ä¸€ä¸ª event å¯¹è±¡ï¼Œå…¶ target å±æ€§ å°±æŒ‡å‘ XHR å¯¹è±¡å®ä¾‹ï¼Œå› è€Œå¯ä»¥è®¿é—®åˆ° XHR å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•å’Œå±æ€§ã€‚ç„¶è€Œï¼Œå¹¶éæ‰€æœ‰æµè§ˆå™¨éƒ½ä¸ºè¿™ä¸ªäº‹ä»¶å®ç°äº†é€‚å½“çš„äº‹ä»¶å¯¹è±¡ã€‚ç»“æœï¼Œå¼€å‘äººå‘˜è¿˜æ˜¯è¦åƒä¸‹é¢è¿™æ ·è¢«è¿«ä½¿ç”¨ XHR å¯¹è±¡å˜é‡</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="progress-äº‹ä»¶"><a href="#progress-äº‹ä»¶" aria-hidden="true" class="header-anchor">#</a> progress äº‹ä»¶</h3> <p>progress äº‹ä»¶ä¼šåœ¨æµè§ˆå™¨æ¥æ”¶æ–°æ•°æ®æœŸé—´å‘¨æœŸæ€§åœ°è§¦å‘</p> <ul><li><code>lengthComputable</code>: æ˜¯ä¸€ä¸ªè¡¨ç¤ºè¿›åº¦ä¿¡æ¯æ˜¯å¦å¯ç”¨çš„å¸ƒå°”å€¼</li> <li><code>position</code>: è¡¨ç¤ºå·²ç»æ¥æ”¶çš„å­—èŠ‚æ•°</li> <li><code>totalSize</code>: è¡¨ç¤ºæ ¹æ® Content-Length å“åº”å¤´éƒ¨ç¡®å®šçš„é¢„æœŸå­—èŠ‚æ•°ã€‚</li></ul> <p>åˆ›å»ºè¿›åº¦æŒ‡ç¤ºå™¨</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request was unsuccessful: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> divStatus <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    divStatus<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span>
      <span class="token string">&quot;Received &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>position <span class="token operator">+</span> <span class="token string">&quot; of &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>totalSize <span class="token operator">+</span> <span class="token string">&quot; bytes&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://www.mocky.io/v2/5e01ea3f2f00007d97dcd401&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="ä¼˜è´¨ä»£ç "><a href="#ä¼˜è´¨ä»£ç " aria-hidden="true" class="header-anchor">#</a> ä¼˜è´¨ä»£ç </h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getError</span><span class="token punctuation">(</span><span class="token parameter">option<span class="token punctuation">,</span> xhr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token template-string"><span class="token string">`cannot </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>option<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>option<span class="token punctuation">.</span>action<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>xhr<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  err<span class="token punctuation">.</span>status <span class="token operator">=</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">;</span>
  err<span class="token punctuation">.</span>method <span class="token operator">=</span> option<span class="token punctuation">.</span>method<span class="token punctuation">;</span>
  err<span class="token punctuation">.</span>url <span class="token operator">=</span> option<span class="token punctuation">.</span>action<span class="token punctuation">;</span>
  <span class="token keyword">return</span> err<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getBody</span><span class="token punctuation">(</span><span class="token parameter">xhr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> text <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText <span class="token operator">||</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> text<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> text<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// option {</span>
<span class="token comment">//  onProgress: (event: { percent: number }): void,</span>
<span class="token comment">//  onError: (event: Error, body?: Object): void,</span>
<span class="token comment">//  onSuccess: (body: Object): void,</span>
<span class="token comment">//  data: Object,</span>
<span class="token comment">//  filename: String,</span>
<span class="token comment">//  file: File,</span>
<span class="token comment">//  withCredentials: Boolean,</span>
<span class="token comment">//  action: String,</span>
<span class="token comment">//  headers: Object,</span>
<span class="token comment">// }</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token punctuation">.</span>onProgress <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>upload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">progress</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>total <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span>percent <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>loaded <span class="token operator">/</span> e<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      option<span class="token punctuation">.</span><span class="token function">onProgress</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> option<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// support key-value array data</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// { list: [ 11, 22 ] }</span>
          <span class="token comment">// formData.append('list[]', 11);</span>
          formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">[]`</span></span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> option<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> option<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

  xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    option<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">onload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// allow success when 2xx status</span>
    <span class="token comment">// see https://github.com/react-component/upload/issues/34</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">200</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> option<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span><span class="token function">getError</span><span class="token punctuation">(</span>option<span class="token punctuation">,</span> xhr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getBody</span><span class="token punctuation">(</span>xhr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    option<span class="token punctuation">.</span><span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token function">getBody</span><span class="token punctuation">(</span>xhr<span class="token punctuation">)</span><span class="token punctuation">,</span> xhr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>method<span class="token punctuation">,</span> option<span class="token punctuation">.</span>action<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Has to be after `.open()`. See https://github.com/enyo/dropzone/issues/179</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token punctuation">.</span>withCredentials <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;withCredentials&quot;</span> <span class="token keyword">in</span> xhr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    xhr<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> headers <span class="token operator">=</span> option<span class="token punctuation">.</span>headers <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// when set headers['X-Requested-With'] = null , can close default XHR header</span>
  <span class="token comment">// see https://github.com/react-component/upload/issues/33</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>headers<span class="token punctuation">[</span><span class="token string">&quot;X-Requested-With&quot;</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;X-Requested-With&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;XMLHttpRequest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> h <span class="token keyword">in</span> headers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> headers<span class="token punctuation">[</span>h<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> headers<span class="token punctuation">[</span>h<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°: </span> <span class="time">12/26/2019, 2:49:21 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/notebook-js/javascript/cors.html" class="prev">
          è·¨åŸŸèµ„æºå…±äº«
        </a></span> <span class="next"><a href="/notebook-js/javascript/fetch.html">
          fetch
        </a>
        â†’
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notebook-js/assets/js/app.0452984d.js" defer></script><script src="/notebook-js/assets/js/2.aba41126.js" defer></script><script src="/notebook-js/assets/js/30.a8cb2a05.js" defer></script>
  </body>
</html>
